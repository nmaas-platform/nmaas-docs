
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.nmaas.eu/self-hosted-nmaas/local-dev-environment/p1_local-kubernetes-cluster/">
      
      <link rel="icon" href="../../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-8.5.7">
    
    
      
        <title>Part 1 - Deploying a Local Kubernetes Cluster - NMaaS Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-ZXZHTYVKN9"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-ZXZHTYVKN9",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-ZXZHTYVKN9",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="light-blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#part-1-deploying-a-local-kubernetes-cluster" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="NMaaS Documentation" class="md-header__button md-logo" aria-label="NMaaS Documentation" data-md-component="logo">
      
  <img src="../../../img/NMaaS-logo-transparent-white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NMaaS Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Part 1 - Deploying a Local Kubernetes Cluster
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="NMaaS Documentation" class="md-nav__button md-logo" aria-label="NMaaS Documentation" data-md-component="logo">
      
  <img src="../../../img/NMaaS-logo-transparent-white.png" alt="logo">

    </a>
    NMaaS Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../what-is-nmaas/" class="md-nav__link">
        What is NMaaS?
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          NMaaS Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="NMaaS Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          NMaaS Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/application-manager-guide/" class="md-nav__link">
        Application Manager Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/domain-admin-guide/" class="md-nav__link">
        Domain Admin Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/user-guide/" class="md-nav__link">
        User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Managed NMaaS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Managed NMaaS" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Managed NMaaS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../managed-nmaas/introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../managed-nmaas/nmaas-playground-instance/" class="md-nav__link">
        NMaaS Playground Instance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Self-Hosted NMaaS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Self-Hosted NMaaS" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Self-Hosted NMaaS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../install-guide/" class="md-nav__link">
        Installation Guide
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3" type="checkbox" id="__nav_5_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5_3">
          Local Development Environment
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Local Development Environment" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          Local Development Environment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Part 1 - Deploying a Local Kubernetes Cluster
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Part 1 - Deploying a Local Kubernetes Cluster
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#virtual-machine-prerequisites" class="md-nav__link">
    Virtual Machine Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#virtual-machine-setup" class="md-nav__link">
    Virtual Machine Setup
  </a>
  
    <nav class="md-nav" aria-label="Virtual Machine Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-new-nat-network-in-virtualbox" class="md-nav__link">
    Creating a New NAT Network in Virtualbox
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-creating-a-new-host-only-network-in-virtualbox" class="md-nav__link">
    Optional: Creating a New Host-Only Network in Virtualbox
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-virtual-machine-in-virtualbox" class="md-nav__link">
    Creating the Virtual Machine in VirtualBox
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-the-guest-operating-system" class="md-nav__link">
    Configuring the Guest Operating System
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubernetes-cluster-setup" class="md-nav__link">
    Kubernetes Cluster Setup
  </a>
  
    <nav class="md-nav" aria-label="Kubernetes Cluster Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-1-microk8s-installation" class="md-nav__link">
    Option 1: MicroK8s Installation
  </a>
  
    <nav class="md-nav" aria-label="Option 1: MicroK8s Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#addons-setup" class="md-nav__link">
    Addons Setup
  </a>
  
    <nav class="md-nav" aria-label="Addons Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cni" class="md-nav__link">
    CNI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns" class="md-nav__link">
    DNS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-dns-resolution" class="md-nav__link">
    Testing DNS Resolution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage" class="md-nav__link">
    Storage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metallb" class="md-nav__link">
    MetalLB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ingress-nginx" class="md-nav__link">
    Ingress Nginx
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helm" class="md-nav__link">
    Helm
  </a>
  
    <nav class="md-nav" aria-label="Helm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-a-newer-helm-version" class="md-nav__link">
    Installing a Newer Helm Version
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-2-k3s-installation" class="md-nav__link">
    Option 2: K3s Installation
  </a>
  
    <nav class="md-nav" aria-label="Option 2: K3s Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#addons-setup_1" class="md-nav__link">
    Addons Setup
  </a>
  
    <nav class="md-nav" aria-label="Addons Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cni_1" class="md-nav__link">
    CNI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns_1" class="md-nav__link">
    DNS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage_1" class="md-nav__link">
    Storage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metallb_1" class="md-nav__link">
    MetalLB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helm_1" class="md-nav__link">
    Helm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ingress-nginx_1" class="md-nav__link">
    Ingress Nginx
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../p2_installing-nmaas/" class="md-nav__link">
        Part 2 - Installing NMaaS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../p3_demo-network-environment/" class="md-nav__link">
        Part 3 - Demo Network Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../p4_monitoring-demo-network-environment/" class="md-nav__link">
        Part 4 - Monitoring the Demo Network Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../p5_adding_custom_app/" class="md-nav__link">
        Part 5 - Adding a Custom Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../appendix/" class="md-nav__link">
        Appendix - Credentials
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          NMaaS Use-Cases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="NMaaS Use-Cases" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          NMaaS Use-Cases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_1" type="checkbox" id="__nav_6_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_1">
          Virtual Lab
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Virtual Lab" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          Virtual Lab
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../use-cases/virtual-lab/vlab-introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../use-cases/virtual-lab/bulk-domain-deployment/" class="md-nav__link">
        Bulk Domain Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../use-cases/virtual-lab/domain-groups/" class="md-nav__link">
        Domain Groups
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../use-cases/virtual-lab/bulk-application-deployment/" class="md-nav__link">
        Bulk Application Deployment
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          NMaaS Applications
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="NMaaS Applications" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          NMaaS Applications
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/general-app-deployment/" class="md-nav__link">
        General Application Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/application-list/" class="md-nav__link">
        List of Supported Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/new-application/" class="md-nav__link">
        Adding a New Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_4" type="checkbox" id="__nav_7_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_4">
          Application Deployment Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Application Deployment Tutorials" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_4">
          <span class="md-nav__icon md-icon"></span>
          Application Deployment Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/oxidized/" class="md-nav__link">
        Oxidized
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/librenms/" class="md-nav__link">
        LibreNMS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/nav/" class="md-nav__link">
        NAV
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/prometheus/" class="md-nav__link">
        Prometheus
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/grafana/" class="md-nav__link">
        Grafana
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/bastion/" class="md-nav__link">
        Bastion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/booked/" class="md-nav__link">
        Booked
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/debian-repository/" class="md-nav__link">
        Debian Repository
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/spa-inventory/" class="md-nav__link">
        SPA Inventory
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_4_10" type="checkbox" id="__nav_7_4_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_4_10">
          PerfSONAR
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="PerfSONAR" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_4_10">
          <span class="md-nav__icon md-icon"></span>
          PerfSONAR
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/psconfig-web-admin/" class="md-nav__link">
        psConfig Web Admin
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/maddash/" class="md-nav__link">
        MaDDash
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/esmond/" class="md-nav__link">
        Esmond
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/perfsonar-central-management/" class="md-nav__link">
        perfSONAR Central Management
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/influxdb/" class="md-nav__link">
        InfluxDB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/jenkins/" class="md-nav__link">
        Jenkins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/elk-stack/" class="md-nav__link">
        ELK Stack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/wifimon/" class="md-nav__link">
        WiFiMon
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/icinga2/" class="md-nav__link">
        Icinga2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/victoria-metrics/" class="md-nav__link">
        Victoria Metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/synapse/" class="md-nav__link">
        Synapse
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/routinator/" class="md-nav__link">
        Routinator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/codimd/" class="md-nav__link">
        CodiMD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/webdav/" class="md-nav__link">
        WebDAV
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/uptime-kuma/" class="md-nav__link">
        Uptime Kuma
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/netbox/" class="md-nav__link">
        Netbox
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/zabbix/" class="md-nav__link">
        Zabbix
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/spa/" class="md-nav__link">
        SPA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/maildev/" class="md-nav__link">
        MailDev
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/changedetectionio/" class="md-nav__link">
        ChangeDetection.io
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/gp4l-orchestrator/" class="md-nav__link">
        GP4L Orchestrator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-applications/tutorials/apache-airflow/" class="md-nav__link">
        Apache Airflow
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Blog
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Blog" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Blog
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/blog1/nmaas-101-1/" class="md-nav__link">
        NMaaS-101 - "Hello NMaaS !"
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/blog2/nmaas-101-2/" class="md-nav__link">
        NMaaS-101 - "I can help! But... Please could you open these two doors?"
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/blog3/nmaas-101-3/" class="md-nav__link">
        NMaaS-101 - "My name is Oxidized and I'm a nifty configuration management tool"
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/blog4/nmaas-101-4/" class="md-nav__link">
        NMaaS-101 - "Prometheus"
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          Release Notes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Release Notes" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Release Notes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../release-notes/1.6.0/" class="md-nav__link">
        1.6.0
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../release-notes/1.5.4/" class="md-nav__link">
        1.5.4
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../nmaas-presentations/" class="md-nav__link">
        NMaaS Presentations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../contact/" class="md-nav__link">
        Contact
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#virtual-machine-prerequisites" class="md-nav__link">
    Virtual Machine Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#virtual-machine-setup" class="md-nav__link">
    Virtual Machine Setup
  </a>
  
    <nav class="md-nav" aria-label="Virtual Machine Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-new-nat-network-in-virtualbox" class="md-nav__link">
    Creating a New NAT Network in Virtualbox
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-creating-a-new-host-only-network-in-virtualbox" class="md-nav__link">
    Optional: Creating a New Host-Only Network in Virtualbox
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-virtual-machine-in-virtualbox" class="md-nav__link">
    Creating the Virtual Machine in VirtualBox
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-the-guest-operating-system" class="md-nav__link">
    Configuring the Guest Operating System
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubernetes-cluster-setup" class="md-nav__link">
    Kubernetes Cluster Setup
  </a>
  
    <nav class="md-nav" aria-label="Kubernetes Cluster Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-1-microk8s-installation" class="md-nav__link">
    Option 1: MicroK8s Installation
  </a>
  
    <nav class="md-nav" aria-label="Option 1: MicroK8s Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#addons-setup" class="md-nav__link">
    Addons Setup
  </a>
  
    <nav class="md-nav" aria-label="Addons Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cni" class="md-nav__link">
    CNI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns" class="md-nav__link">
    DNS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-dns-resolution" class="md-nav__link">
    Testing DNS Resolution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage" class="md-nav__link">
    Storage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metallb" class="md-nav__link">
    MetalLB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ingress-nginx" class="md-nav__link">
    Ingress Nginx
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helm" class="md-nav__link">
    Helm
  </a>
  
    <nav class="md-nav" aria-label="Helm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-a-newer-helm-version" class="md-nav__link">
    Installing a Newer Helm Version
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-2-k3s-installation" class="md-nav__link">
    Option 2: K3s Installation
  </a>
  
    <nav class="md-nav" aria-label="Option 2: K3s Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#addons-setup_1" class="md-nav__link">
    Addons Setup
  </a>
  
    <nav class="md-nav" aria-label="Addons Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cni_1" class="md-nav__link">
    CNI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns_1" class="md-nav__link">
    DNS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage_1" class="md-nav__link">
    Storage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metallb_1" class="md-nav__link">
    MetalLB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helm_1" class="md-nav__link">
    Helm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ingress-nginx_1" class="md-nav__link">
    Ingress Nginx
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<div><h1 id="part-1-deploying-a-local-kubernetes-cluster">Part 1: Deploying a Local Kubernetes Cluster</h1>
<p>This tutorial will assume that NMaaS is installed in a virtual machine that is completely isolated from any production environment. However, the discussed steps are applicable to bare-metal hardware as well, once the correct network strategy has been identified by the system administrator.</p>
<h2 id="virtual-machine-prerequisites">Virtual Machine Prerequisites</h2>
<ul>
<li>Ubuntu &gt;= 20.04 Server or any Desktop flavor</li>
<li>12GB+ RAM</li>
<li>2+ VCPUs</li>
<li>60GB+ storage space</li>
</ul>
<h2 id="virtual-machine-setup">Virtual Machine Setup</h2>
<p>Although we will focus on VirtualBox, any virtualization software can be used, depending on the user's preference. Virtualbox 6 is an open-source virtualization software which can be downloaded for free from the <a href="https://www.virtualbox.org/wiki/Downloads">official website</a>.</p>
<p>After installation, additional network configuration needs to be done before a Kubernetes cluster can be set up. The following network configuration creates a completely isolated network environment from the production network. NMaaS will only be accessible from the host operating system where the virtual machine is deployed. </p>
<p>Our virtual machine will need three network interfaces in total:</p>
<ul>
<li>3 NAT type network adapters (from the same NAT network) which are created manually in Virtualbox (one for Kubernetes, two for freeRTR)</li>
<li><strong>Optional:</strong> 1 Host-only type network adapter which is also created manually in Virtualbox - for accessing the NAT network from the host system. Using this approach, the NMaaS instance deployed inside the virtual machine will be made accessible by adding a custom route on the host operating system towards the NAT network, traversing the host-only interfaces.</li>
</ul>
<p>DHCP should not be enabled for the second or third NAT interfaces, but DHCP should be enabled for the first NAT interface. If an optional host interface has been added, DHCP should be enabled on it as well.</p>
<p>Detailed description of the required configuration steps is given below.</p>
<h3 id="creating-a-new-nat-network-in-virtualbox">Creating a New NAT Network in Virtualbox</h3>
<ul>
<li>
<p>Navigate to <code>File -&gt; Preferences -&gt; Network</code> and click the Plus button on the right hand side.</p>
<p><a class="glightbox" href="../img/01-new-nat-network.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Creating a new NAT network in Virtualbox" src="../img/01-new-nat-network.png"></a></p>
</li>
<li>
<p>Once added, click on the cog icon to configure the newly created network. Alter the network name as desired, and enter a preferred CIDR. Make sure that the <code>Supports DHCP</code> option is checked.</p>
<p><a class="glightbox" href="../img/02-nat-network-config.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Configuring the new NAT network in Virtualbox" src="../img/02-nat-network-config.png"></a></p>
</li>
<li>
<p>If the pre-prepared NMaaS VirtualBox image is used, make sure to select the exact same Network CIDR (10.99.99.0/24) since all NMaaS components have already been installed and expect addresses in the 10.99.99.0/24 range.</p>
</li>
</ul>
<h3 id="optional-creating-a-new-host-only-network-in-virtualbox">Optional: Creating a New Host-Only Network in Virtualbox</h3>
<p>If the NMaaS installation needs to be accessible from other networks, one option is to add a Host-Only interface to the virtual machine that will act as a transit between the outside networks and the internal VirtualBox NAT network configured in the previous step.</p>
<ul>
<li>
<p>Navigate to <code>File -&gt; Host Network Manager</code> and click on the green <code>Create</code> Button.</p>
<p><a class="glightbox" href="../img/03-new-host-only-network.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Creating a new host only network in Virtualbox" src="../img/03-new-host-only-network.png"></a></p>
</li>
<li>
<p>Select the Configure Adapter Manually radio button and enter the IP address that will be allocated to the host interface connected to the hypervisor along with an appropriate network mask. <strong>Make sure that the selected range does not overlap with any existing network or the previously created NAT network.</strong></p>
<p><a class="glightbox" href="../img/04-host-only-network-config.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Configuring the new host only network in Virtualbox" src="../img/04-host-only-network-config.png"></a></p>
</li>
</ul>
<h3 id="creating-the-virtual-machine-in-virtualbox">Creating the Virtual Machine in VirtualBox</h3>
<p>Create a regular virtual machine in VirtualBox, using the latest Ubuntu 20.04 ISO. The following parameters need to be altered:</p>
<ul>
<li>Allocate sufficient memory to the virtual machine. 12GB is the minimum amount which will support a complete NMaaS installation, along with the possibility for deploying additional applications via the catalog.</li>
<li>Allocate sufficient number of CPU cores, depending on the performance of your system.</li>
<li>In the <code>Network</code> configuration tab, add three adapters:<ul>
<li>Adapter 1: NAT Network (Select the network created <a href="./#creating-a-new-nat-network-in-virtualbox">previously</a>)</li>
<li>Adapter 2: NAT Network (Select the network created <a href="./#creating-a-new-nat-network-in-virtualbox">previously</a>)</li>
<li>Adapter 3: NAT Network (Select the network created <a href="./#creating-a-new-nat-network-in-virtualbox">previously</a>)</li>
</ul>
</li>
<li><strong>Optional:</strong> Adapter 4: Host-only Adapter (Select the network created <a href="./#optional-creating-a-new-host-only-network-in-virtualbox">previously</a>)</li>
<li>If a Desktop version of Ubuntu is being installed, make sure to enable 3D acceleration in the <code>Display</code> tab.</li>
</ul>
<h3 id="configuring-the-guest-operating-system">Configuring the Guest Operating System</h3>
<p>Once the guest operating system has been installed, DHCP should be manually disabled on the second and third NAT interfaces. In case of an Ubuntu Server installation, this can be done by editing the Netplan configuration, located in <code>/etc/netplan/00-installer-config.yaml</code>:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">/etc/netplan/00-installer-config.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span>
<span class="normal"><a href="#__codelineno-0-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nt">network</span><span class="p">:</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">  </span><span class="nt">ethernets</span><span class="p">:</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="nn">...</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">    </span><span class="nt">enp0s8</span><span class="p">:</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">      </span><span class="nt">dhcp4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="nn">...</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span></code></pre></div></td></tr></table></div>
<p>Make sure to execute <code>sudo netplan apply</code> so that the new changes will take effect.</p>
<p>Desktop editions of Ubuntu usually come with their own GUI network manager, so the interface status should be set to <code>Disabled</code>:</p>
<p><a class="glightbox" href="../img/05-disable-extra-interfaces-gui.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Disabling extra interfaces in GUI versions of Ubuntu" src="../img/05-disable-extra-interfaces-gui.png"></a></p>
<p><strong>Optional:</strong> In case a host-only interface has been added to the virtual machine, create a route on your host operating system towards the NAT network via the host-only network interface. Examples are given below both for Microsoft Windows and GNU/Linux host operating systems below.</p>
<div class="language-powershell highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Microsoft Windows</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="n">route</span> <span class="n">add</span> <span class="p">&lt;</span><span class="n">NAT_NETWORK</span><span class="p">&gt;</span> <span class="n">mask</span> <span class="p">&lt;</span><span class="n">SUBNET_MASK</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="n">VIRTUALBOX_HOST_NETWORK_IP</span><span class="p">&gt;</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="c"># Using the examples above, the command would be:</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="c"># route add 10.99.99.0 mask 255.255.255.0 192.168.56.1</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-bash highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">GNU/Linux</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a>ip<span class="w"> </span>route<span class="w"> </span>add<span class="w"> </span>&lt;NAT_NETWORK&gt;/&lt;CIDR_PREFIX&gt;<span class="w"> </span>via<span class="w"> </span>&lt;VIRTUALBOX_HOST_NETWORK_IP&gt;
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="c1"># Using the examples above, the command would be:</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="c1"># ip route add 10.99.99.0/24 via 192.168.56.1</span>
</span></code></pre></div></td></tr></table></div>
<h2 id="kubernetes-cluster-setup">Kubernetes Cluster Setup</h2>
<p>In this section we discuss two quick methods of setting up a local Kubernetes cluster.</p>
<h3 id="option-1-microk8s-installation">Option 1: MicroK8s Installation</h3>
<p>MicroK8s is a snap-based application that can setup a fully functional Kubernetes cluster by executing a single command. It also supports many popular addons which can also be enabled very easily.</p>
<p>MicroK8s abstracts away many Kubernetes configuration steps, especially when using the addon system. This can be seen as either an advantage or a disadvantage. </p>
<ul>
<li>
<p>Install the MicroK8s snap, using the 1.20 version:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a>sudo<span class="w"> </span>snap<span class="w"> </span>install<span class="w"> </span>microk8s<span class="w"> </span>--classic<span class="w"> </span>--channel<span class="o">=</span><span class="m">1</span>.20/stable
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>Add the current user to the <code>microk8s</code> group so that access to the <code>microk8s</code> command is unrestricted:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a>sudo<span class="w"> </span>usermod<span class="w"> </span>-a<span class="w"> </span>-G<span class="w"> </span>microk8s<span class="w"> </span><span class="nv">$USER</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a>sudo<span class="w"> </span>chown<span class="w"> </span>-f<span class="w"> </span>-R<span class="w"> </span><span class="nv">$USER</span><span class="w"> </span>~/.kube
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a>su<span class="w"> </span>-<span class="w"> </span><span class="nv">$USER</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>Wait until everything is ready:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a>microk8s<span class="w"> </span>status<span class="w"> </span>--wait-ready
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>Manually check the node status and the list of running pods:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a>microk8s<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>node
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a>microk8s<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>--all-namespaces
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<h4 id="addons-setup">Addons Setup</h4>
<h5 id="cni">CNI</h5>
<p>Calico comes installed by default, no further manual configuration is required.</p>
<h5 id="dns">DNS</h5>
<p>To enable CoreDNS the following command should be executed:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a>microk8s<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>dns
</span></code></pre></div></td></tr></table></div>
<p>By default the Google DNS servers will be used as upstreams (8.8.8.8 and 8.8.4.4). If there is a local DNS server available that should be used instead, it can be specified using semicolons:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a>microk8s<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>dns:192.168.1.1
</span></code></pre></div></td></tr></table></div>
<p>Once the command is executed, all of the necessary Kubernetes resources are immediately created and the associated pods brought up:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span>
<span class="normal"><a href="#__codelineno-9-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a>microk8s<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>-n<span class="w"> </span>kube-system
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2"></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="c1"># NAME                                      READY   STATUS    RESTARTS   AGE</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="c1"># calico-node-gvlsm                         1/1     Running   0          8m39s</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="c1"># coredns-86f78bb79c-zhn7p                  1/1     Running   0          74s</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="c1"># calico-kube-controllers-847c8c99d-vrlm2   1/1     Running   0          8m42s</span>
</span></code></pre></div></td></tr></table></div>
<h5 id="testing-dns-resolution">Testing DNS Resolution</h5>
<p>Testing the DNS resolution is an optional, but recommended step to ensure that the deployed CoreDNS instance is functioning properly. To do so, an instance of <code>dnsutils</code> can be deployed:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a>microk8s<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://k8s.io/examples/admin/dns/dnsutils.yaml
</span></code></pre></div></td></tr></table></div>
<p>Once the Pod enters a ready state, we can open a shell session:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span>
<span class="normal"><a href="#__codelineno-11-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a>microk8s<span class="w"> </span>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>dnsutils<span class="w"> </span>--<span class="w"> </span>/bin/sh
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2"></a>ping<span class="w"> </span>geant.org
</span></code></pre></div></td></tr></table></div>
<h5 id="storage">Storage</h5>
<p>A local path provisioner can be enabled using:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a>microk8s<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>storage
</span></code></pre></div></td></tr></table></div>
<p>Beware when using this in clusters with more than one node.</p>
<h5 id="metallb">MetalLB</h5>
<p>MetalLB is a Kubernetes LoadBalancer implementation. </p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1"></a>microk8s<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>metallb:192.168.99.150-192.168.99.200
</span></code></pre></div></td></tr></table></div>
<p>Pick a free range from the local address space for easiest access during testing.</p>
<h5 id="ingress-nginx">Ingress Nginx</h5>
<p>Ingress Nginx is a popular Ingress controller for Kubernetes, based on the widely used Nginx web server.</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1"></a>microk8s<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>ingress
</span></code></pre></div></td></tr></table></div>
<p>To make the newly deployed ingress accessible from outside the CNI network, a LoadBalancer Service can be created with an address assigned by MetalLB:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">ingress-lb.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress-microk8s</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1"></a>microk8s<span class="w"> </span>kubectl<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>ingress-lb.yaml<span class="w"> </span>--save-config
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2"></a>microk8s<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>service<span class="w"> </span>-n<span class="w"> </span>ingress
</span></code></pre></div></td></tr></table></div>
<p>Once the assigned IP to the LoadBalancer Service has been acquired by executing the previous command, a browser window can be opened on the local workstation so as to perform a test access to the Ingress Controller. A generic <code>404 not found</code> message should be displayed.</p>
<h5 id="helm">Helm</h5>
<p>Helm is a package manager for Kubernetes allowing seamless installation of complex application. NMaaS and all of its dependencies have also been packaged as Helm charts, thus easing their deployment process.</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1"></a>microk8s<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>helm3
</span></code></pre></div></td></tr></table></div>
<p>Similarly to the way that the kubectl client is accessed, Helm can be invoked using:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1"></a>microk8s<span class="w"> </span>helm3<span class="w"> </span>&lt;HELM_COMMAND&gt;
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="c1"># for example:</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3"></a>microk8s<span class="w"> </span>helm3<span class="w"> </span>list<span class="w"> </span>--all-namespaces
</span></code></pre></div></td></tr></table></div>
<div class="admonition danger">
<p class="admonition-title">Helm Version</p>
<p>Unfortunately, the Helm version installed in this manner, as an official MicroK8s addon is too old. A newer version, if needed, can be installed by following the instructions available below. <strong>Please note that the GitLab chart, which is a dependency of NMaaS requires a newer Helm version than the one installed as a MicroK8s addon.</strong></p>
</div>
<h6 id="installing-a-newer-helm-version">Installing a Newer Helm Version</h6>
<ul>
<li>Download the latest Helm release from <a href="https://github.com/helm/helm/releases">https://github.com/helm/helm/releases</a> for your architecture (e.g. <a href="https://get.helm.sh/helm-v3.7.0-linux-amd64.tar.gz">https://get.helm.sh/helm-v3.7.0-linux-amd64.tar.gz</a>).</li>
<li>
<p>Unpack the downloaded archive file and move it to a location in <code>PATH</code>.</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span>
<span class="normal"><a href="#__codelineno-19-3">3</a></span>
<span class="normal"><a href="#__codelineno-19-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1"></a>wget<span class="w"> </span>https://get.helm.sh/helm-v3.7.0-linux-amd64.tar.gz<span class="w"> </span>-O<span class="w"> </span>helm-latest.tar.gz
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2"></a>tar<span class="w"> </span>-xvzf<span class="w"> </span>helm-latest.tar.gz
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3"></a>mv<span class="w"> </span>linux-amd64/helm<span class="w"> </span>/usr/local/bin
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4"></a>chmod<span class="w"> </span>+x<span class="w"> </span>/usr/local/bin/helm
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>Finally, the kube config to interact with the MicroK8s Kubernetes cluster needs to be copied to the appropriate location:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1"></a>microk8s.config<span class="w"> </span>&gt;<span class="w"> </span>~/.kube/config
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<h3 id="option-2-k3s-installation">Option 2: K3s Installation</h3>
<p>K3s is another easy way to configure a full-fledged Kubernetes cluster in a matter of minutes. K3s is more lightweight than other Kubernetes distributions since it does not ship with unnecessary modules, such as the ones for integrating with various cloud providers. K3s offers seamless scalability across multiple nodes and provides the ability to either use an embedded database for storing the cluster state or a relational one, such as PostgreSQL or MySQL.</p>
<ul>
<li>
<p>K3s can be installed with the following command:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">INSTALL_K3S_VERSION</span><span class="o">=</span>v1.20.14+k3s2
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2"></a>curl<span class="w"> </span>-sfL<span class="w"> </span>https://get.k3s.io<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh<span class="w"> </span>-s<span class="w"> </span>-<span class="w"> </span>server<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3"></a>--tls-san<span class="w"> </span>demo.nmaas.local<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4"></a>--tls-san<span class="w"> </span><span class="m">10</span>.99.99.100<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5"></a>--disable<span class="o">=</span>traefik<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6"></a>--flannel-backend<span class="o">=</span>none<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7"></a>--disable-network-policy<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8"></a>--disable<span class="o">=</span>servicelb<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9"></a>--write-kubeconfig-mode<span class="w"> </span><span class="m">664</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10"></a>--cluster-cidr<span class="o">=</span><span class="m">10</span>.136.0.0/16
</span></code></pre></div></td></tr></table></div>
<ul>
<li><code>--tls-san</code> – can be specified multiple times to add additional names for which the automatically generated Kubernetes API certificates will be valid. <strong>Make sure to replace the IP address with the IP address of your VM</strong>.</li>
<li><code>--disable=traefik</code> – Traefik needs to be explicitly disabled since it ships by default with new K3s installations. We will use ingress-nginx as our ingress controller and will install it manually in a later step.</li>
<li><code>--flannel-backend=none</code> – Flannel CNI needs to be explicitly disabled, since we will manually install Calico.</li>
<li><code>--disable-network-policy</code> – we do not need the default network policy addon that enabled the use of Kubernetes NetworkPolicy objects, since Calico has built-in support for network policies.</li>
<li><code>--disable=servicelb</code> – the preconfigured implementation for LoadBalancer service objects should be disabled, since we will manually install MetalLB.</li>
<li><code>--write-kubeconfig-mode 664</code> – more permissive permissions are needed for the automatically generated kubeconfig file so that regular users, apart from root, can use the kubectl client as well.</li>
<li><code>--clister-cidr=10.136.0.0/16</code> – a free subnet range which will be used as the pod network. Should be written down since it will be required in the Calico deployment as well.</li>
</ul>
</li>
<li>
<p>Another way of providing <code>kubectl</code> access to different users is to make a copy of the original kubeconfig file located in <code>/etc/rancher/k3s/k3s.yaml</code> into a directory and changing its permissions. Then, by exporting the <code>KUBECONFIG</code> environment variable, the kubectl client will be forced to use the newly created configuration:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">KUBECONFIG</span><span class="o">=</span>~/.kube/config
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>Our cluster is still not in a Ready state, since we do not have a CNI plugin installed yet.</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>node<span class="w"> </span>-o<span class="w"> </span>wide
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<h4 id="addons-setup_1">Addons Setup</h4>
<h5 id="cni_1">CNI</h5>
<ul>
<li>
<p>Calico can be manually installed by downloading the manifest file and setting the CALICO_IPV4POOL_CIDR parameter to the value set when deploying K3s.</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span>
<span class="normal"><a href="#__codelineno-24-2">2</a></span>
<span class="normal"><a href="#__codelineno-24-3">3</a></span>
<span class="normal"><a href="#__codelineno-24-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>~/manifests/calico
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="nb">cd</span><span class="w"> </span>~/manifests/calico
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3"></a>wget<span class="w"> </span>https://docs.projectcalico.org/manifests/calico.yaml
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4"></a>nano<span class="w"> </span>calico.yaml
</span></code></pre></div></td></tr></table></div>
<div class="language-yaml highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">calico.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span>
<span class="normal"><a href="#__codelineno-25-2">2</a></span>
<span class="normal"><a href="#__codelineno-25-3">3</a></span>
<span class="normal"><a href="#__codelineno-25-4">4</a></span>
<span class="normal"><a href="#__codelineno-25-5">5</a></span>
<span class="normal"><a href="#__codelineno-25-6">6</a></span>
<span class="normal"><a href="#__codelineno-25-7">7</a></span>
<span class="normal"><a href="#__codelineno-25-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="nn">...</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="w">            </span><span class="c1"># The default IPv4 pool to create on startup if none exists. Pod IPs will be</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="w">            </span><span class="c1"># chosen from this range. Changing this value after installation will have</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="w">            </span><span class="c1"># no effect. This should fall within `--cluster-cidr`.</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CALICO_IPV4POOL_CIDR</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"10.136.0.0/16"</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="w">            </span><span class="c1"># Disable file logging so `kubectl logs` works.</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="nn">...</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1"></a>kubectl<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>calico.yaml<span class="w"> </span>--save-config
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>Once Calico has been installed, the node should transition to a <code>Ready</code> state.</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>node<span class="w"> </span>-o<span class="w"> </span>wide
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<h5 id="dns_1">DNS</h5>
<p>CoreDNS is installed by default with K3s, so no need for any manual installation or configuration. Once Calico CNI has been deployed and the cluster has entered a <code>Ready</code> state, DNS resolution can be tested using the <code>dnsutil</code> pod, as described in the official Kubernetes documentation page.</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://k8s.io/examples/admin/dns/dnsutils.yaml
</span></code></pre></div></td></tr></table></div>
<p>Once the Pod enters a ready state, we can open a shell session:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span>
<span class="normal"><a href="#__codelineno-29-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>dnsutils<span class="w"> </span>--<span class="w"> </span>/bin/sh
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2"></a>ping<span class="w"> </span>geant.org
</span></code></pre></div></td></tr></table></div>
<h5 id="storage_1">Storage</h5>
<p>An instance of local path provisioner is automatically installed when deploying K3s, which is sufficient for development single-node clusters such as ours.</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span>
<span class="normal"><a href="#__codelineno-30-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="c1"># kubectl get storageclass</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2"></a>NAME<span class="w">                   </span>PROVISIONER<span class="w">             </span>RECLAIMPOLICY<span class="w">   </span>VOLUMEBINDINGMODE<span class="w">      </span>ALLOWVOLUMEEXPANSION<span class="w">   </span>AGE
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3"></a>local-path<span class="w"> </span><span class="o">(</span>default<span class="o">)</span><span class="w">   </span>rancher.io/local-path<span class="w">   </span>Delete<span class="w">          </span>WaitForFirstConsumer<span class="w">   </span><span class="nb">false</span><span class="w">                  </span>45h
</span></code></pre></div></td></tr></table></div>
<h5 id="metallb_1">MetalLB</h5>
<p>MetalLB can be installed using the official Kubernetes manifests.</p>
<ul>
<li>
<p>To install MetalLB, first the <code>metallb-system</code> namespace must be created:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/metallb/metallb/v0.11.0/manifests/namespace.yaml
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>Once the namespace has been created, it can be populated with all of the other necessary components:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/metallb/metallb/v0.11.0/manifests/metallb.yaml
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>Finally, a default configuration ConfigMap should be created, describing the address range allocated to MetalLB. Please make sure to select an unused block of space. In our case, we will use addresses <code>10.99.99.150</code> to <code>10.99.99.200</code> from the GEANT NAT network which we configured in VirtualBox at the start of the guide.</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">metallb-config.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-33-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-33-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-33-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-33-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-33-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-33-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-33-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-33-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-33-10">10</a></span>
<span class="normal"><a href="#__codelineno-33-11">11</a></span>
<span class="normal"><a href="#__codelineno-33-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metallb-system</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="nt">data</span><span class="p">:</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7"></a><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="w">    </span><span class="no">address-pools:</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="w">    </span><span class="no">- name: default</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10"></a><span class="w">    </span><span class="no">protocol: layer2</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11"></a><span class="w">    </span><span class="no">addresses:</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12"></a><span class="w">    </span><span class="no">- 10.99.99.150-10.99.99.200</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1"></a>kubectl<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>metallb-config.yaml<span class="w"> </span>--save-config
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<h5 id="helm_1">Helm</h5>
<p>To install Helm, we need to first download the latest binary for our architecture and extract it to a location which is in the <code>PATH</code> system variable.</p>
<ul>
<li>Visit <a href="https://github.com/helm/helm/releases">https://github.com/helm/helm/releases</a> and copy the download link for the latest release.</li>
<li>
<p>Download the latest release locally</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span>
<span class="normal"><a href="#__codelineno-35-2">2</a></span>
<span class="normal"><a href="#__codelineno-35-3">3</a></span>
<span class="normal"><a href="#__codelineno-35-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>mktemp<span class="w"> </span>-d<span class="k">)</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2"></a>wget<span class="w"> </span>https://get.helm.sh/helm-v3.7.1-linux-amd64.tar.gz
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3"></a>tar<span class="w"> </span>-xvzf<span class="w"> </span>helm-v3.7.1-linux-amd64.tar.gz
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4"></a>sudo<span class="w"> </span>mv<span class="w"> </span>helm<span class="w"> </span>/usr/local/bin/helm
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>Test whether Helm has been successfully installed by executing <code>helm version</code>.</p>
</li>
</ul>
<h5 id="ingress-nginx_1">Ingress Nginx</h5>
<p>The last application that needs to be installed before we can move on to installing the NMaaS components is Ingress Nginx. Since we have already configured Helm, the Ingress Nginx installation is simple.</p>
<ul>
<li>
<p>Customize the values.yaml file according to the local environment:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">ingress-values.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-36-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-36-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-36-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span>
<span class="normal"><a href="#__codelineno-36-11">11</a></span>
<span class="normal"><a href="#__codelineno-36-12">12</a></span>
<span class="normal"><a href="#__codelineno-36-13">13</a></span>
<span class="normal"><a href="#__codelineno-36-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="nt">defaultBackend</span><span class="p">:</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="nt">controller</span><span class="p">:</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="w">    </span><span class="nt">config</span><span class="p">:</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="w">        </span><span class="nt">log-format-upstream</span><span class="p">:</span><span class="w"> </span><span class="s">'{"time":</span><span class="nv"> </span><span class="s">"$time_iso8601",</span><span class="nv"> </span><span class="s">"remote_addr":</span><span class="nv"> </span><span class="s">"$proxy_protocol_addr",</span><span class="nv"> </span><span class="s">"x-forward-for":</span><span class="nv"> </span><span class="s">"$proxy_add_x_forwarded_for",</span><span class="nv"> </span><span class="s">"request_id":</span><span class="nv"> </span><span class="s">"$req_id",</span><span class="nv"> </span><span class="s">"remote_user":</span><span class="nv"> </span><span class="s">"$remote_user",</span><span class="nv"> </span><span class="s">"bytes_sent":</span><span class="nv"> </span><span class="s">$bytes_sent,</span><span class="nv"> </span><span class="s">"request_time":</span><span class="nv"> </span><span class="s">$request_time,</span><span class="nv"> </span><span class="s">"status":$status,</span><span class="nv"> </span><span class="s">"vhost":</span><span class="nv"> </span><span class="s">"$host",</span><span class="nv"> </span><span class="s">"request_proto":</span><span class="nv"> </span><span class="s">"$server_protocol",</span><span class="nv"> </span><span class="s">"path":</span><span class="nv"> </span><span class="s">"$uri",</span><span class="nv"> </span><span class="s">"request_query":</span><span class="nv"> </span><span class="s">"$args",</span><span class="nv"> </span><span class="s">"request_length":</span><span class="nv"> </span><span class="s">$request_length,</span><span class="nv"> </span><span class="s">"duration":</span><span class="nv"> </span><span class="s">$request_time,"method":</span><span class="nv"> </span><span class="s">"$request_method",</span><span class="nv"> </span><span class="s">"http_referrer":</span><span class="nv"> </span><span class="s">"$http_referer",</span><span class="nv"> </span><span class="s">"http_user_agent":</span><span class="nv"> </span><span class="s">"$http_user_agent"</span><span class="nv"> </span><span class="s">}'</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6"></a><span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="w">    </span><span class="nt">ingressClass</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8"></a><span class="w">    </span><span class="nt">scope</span><span class="p">:</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9"></a><span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11"></a><span class="w">    </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12"></a><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13"></a><span class="w">    </span><span class="nt">metrics</span><span class="p">:</span>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14"></a><span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span></code></pre></div></td></tr></table></div>
<p>In our case we have opted to use a Deployment instead of a DaemonSet for the deployment strategy. Additionally, we have selected a service type of LoadBalancer since we have already installed MetalLB and it is ready to allocate an IP address to our LoadBalancer service.</p>
</li>
<li>
<p>Add the <code>ingress-nginx</code> Helm repository and install the application:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span>
<span class="normal"><a href="#__codelineno-37-2">2</a></span>
<span class="normal"><a href="#__codelineno-37-3">3</a></span>
<span class="normal"><a href="#__codelineno-37-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1"></a>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>ingress-nginx<span class="w"> </span>https://kubernetes.github.io/ingress-nginx
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2"></a>helm<span class="w"> </span>repo<span class="w"> </span>update
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3"></a>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>nmaas-system
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4"></a>helm<span class="w"> </span>install<span class="w"> </span>-f<span class="w"> </span>ingress-values.yaml<span class="w"> </span>--namespace<span class="w"> </span>nmaas-system<span class="w"> </span>nmaas-ingress<span class="w"> </span>ingress-nginx/ingress-nginx
</span></code></pre></div></td></tr></table></div>
<p>We have chosen to install <code>ingress-nginx</code> in the <code>nmaas-system</code> namespace, which will house all the other NMaaS components as well.</p>
<div class="admonition danger">
<p class="admonition-title">Note About Helm Errors</p>
<p>When running the helm install command, Helm might throw an error about the cluster being unreachable. This is most likely because Helm looks for the kube.config file in the default location, but <code>--write-kubeconfig-mode 664</code> has been specified during the K3s installation, and the actual location is <code>/etc/rancher/k3s/k3s.yaml</code>.</p>
<p>This can be fixed by simply executing:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">KUBECONFIG</span><span class="o">=</span><span class="s1">'/etc/rancher/k3s/k3s.yaml'</span>
</span></code></pre></div></td></tr></table></div>
</div>
</li>
<li>
<p>We can test the installed ingress by directly visiting the allocated LoadBalancer IP address in a browser. We should be presented with a generic <code>404-not found</code> page.</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">1</a></span>
<span class="normal"><a href="#__codelineno-39-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>service<span class="w"> </span>-n<span class="w"> </span>nmaas-system
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2"></a>curl<span class="w"> </span>--insecure<span class="w"> </span>https://10.99.99.150
</span></code></pre></div></td></tr></table></div>
</li>
</ul></div>


  




                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
          <footer class="md-footer">
    
      
        
        <nav class="md-footer__inner md-grid" aria-label="" >
          
            
            <a href="../introduction/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Introduction" rel="prev">
              <div class="md-footer__button md-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
              </div>
              <div class="md-footer__title">
                <span class="md-footer__direction">
                  Previous
                </span>
                <div class="md-ellipsis">
                  Introduction
                </div>
              </div>
            </a>
          
          
            
            <a href="../p2_installing-nmaas/" class="md-footer__link md-footer__link--next" aria-label="Next: Part 2 - Installing NMaaS" rel="next">
              <div class="md-footer__title">
                <span class="md-footer__direction">
                  Next
                </span>
                <div class="md-ellipsis">
                  Part 2 - Installing NMaaS
                </div>
              </div>
              <div class="md-footer__button md-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
              </div>
            </a>
          
        </nav>
      
    
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <!--
 Copyright (c) 2016-2022 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Copyright and theme information -->
<div class="md-copyright">
    
    <div class="md-copyright__highlight">
        <a href="#__consent">Change cookie settings</a>

    </div>
    
    
    Made with
    <span class="twemoji heart">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 20.408c-.492.308-.903.546-1.192.709-.153.086-.308.17-.463.252h-.002a.75.75 0 0 1-.686 0 16.709 16.709 0 0 1-.465-.252 31.147 31.147 0 0 1-4.803-3.34C3.8 15.572 1 12.331 1 8.513 1 5.052 3.829 2.5 6.736 2.5 9.03 2.5 10.881 3.726 12 5.605 13.12 3.726 14.97 2.5 17.264 2.5 20.17 2.5 23 5.052 23 8.514c0 3.818-2.801 7.06-5.389 9.262A31.146 31.146 0 0 1 14 20.408z"/></svg>
    </span> by NMaaS contributors and <a href="https://squidfunk.github.io/mkdocs-material/">Material for MkDocs</a>
    
</div>
        
      <div style="display: flex; justify-content: space-between; align-items: center">
        <div><img class="logo" src="../../../img/geant_logo_white.png" /></div>
        <div><img class="logo" src="../../../img/eu_logo.png"</div>
      </div>
      </div>
    </div>
  </footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  




  

<h4>Cookie Consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input type="checkbox" class="md-toggle" id="__settings">
<div class="md-consent__settings">
  <ul class="task-list">
    
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        <label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);console.log(new FormData(form)),__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "navigation.footer"], "search": "../../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.8492ddcf.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>